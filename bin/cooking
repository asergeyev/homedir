#!/bin/sh

# CREATE empty cookbook

COOKBOOK=$1

if [[ -d ./$COOKBOOK ]]; then
    echo "There is no need to create this cookbook, it exists."
    exit 2
fi

git init --quiet $COOKBOOK || exit

cd $COOKBOOK/
echo "0.0.0" > VERSION
cat > README.md  <<EOF
# $COOKBOOK

No description...

## Attributes

None.

## $COOKBOOK::default

Default recipe.


## License

Copyright (c) $(date +%Y) $(git config user.name) <$(git config user.email)>. All rights reserved.

EOF

cat >metadata.rb <<EOF
name "$COOKBOOK"
long_description IO.read(File.join(File.dirname(__FILE__), "README.md"))
version          IO.read(File.join(File.dirname(__FILE__), "VERSION")) rescue "crash chefrun"
EOF

cat >Berksfile <<EOF
site :opscode
metadata
EOF

mkdir -p recipes
touch recipes/default.rb

kitchen init --driver=kitchen-vagrant >/dev/null 2>&1
echo "Berksfile.lock" >> .gitignore

git add VERSION README.md metadata.rb recipes/default.rb .gitignore .kitchen.yml Berksfile

echo "Cookbook is ready, now examine git status before your first commit!"
echo "  \$ cd $COOKBOOK"
echo "  \$ git status"
echo "We also recommend to edit README.md as soon as you can :)"


